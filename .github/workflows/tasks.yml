name: Task Progress

on: workflow_dispatch

jobs:
  progress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v2
        with:
          script: |
            const filterLabel = '2020 tasks'
            const progressIssueID = 5

            let report = Date()

            const taskIssues = await github.paginate(github.issues.listForRepo, {
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: filterLabel
            })

            for (const issue of taskIssues) {
              core.info(Object.keys(issue))
            }

            const progressIssue = await github.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: progressIssueID
            })

            core.info(Object.keys(progressIssue.data))

            github.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: progressIssueID,
              body: progressIssue.data.body.replace(/<!-- REPORT START -->[\s\S]*<!-- REPORT END -->/, `<!-- REPORT START -->\n${report}\n<!-- REPORT END -->`)
            })
